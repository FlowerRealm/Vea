/**
 * @vea/sdk v1.0.0
 * (c) 2025 Vea Project
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VeaSDK={})}(this,function(t){"use strict";class e extends Error{constructor(t,e,s){super(t),this.name="VeaError",this.statusCode=e,this.response=s}}class s{constructor(t={}){this.baseURL=(t.baseURL||"http://localhost:8080").replace(/\/$/,""),this.timeout=t.timeout||3e5,this.headers=t.headers||{},this.isBrowser="undefined"!=typeof window&&void 0!==window.document,this.isNode="undefined"!=typeof process&&process.versions&&process.versions.node,this.nodes=new n(this),this.configs=new r(this),this.geo=new i(this),this.components=new o(this),this.xray=new c(this),this.traffic=new a(this),this.settings=new u(this)}async request(t){const{method:s="GET",path:n,body:r,headers:i={},timeout:o=this.timeout}=t,c=`${this.baseURL}${n}`,a={...this.headers,...i};!r||r instanceof FormData||(a["Content-Type"]="application/json");const l={method:s,headers:a};r&&(l.body=r instanceof FormData?r:JSON.stringify(r));const u=new AbortController,h=setTimeout(()=>u.abort(),o);l.signal=u.signal;try{const t=await fetch(c,l);return clearTimeout(h),await this._handleResponse(t)}catch(t){if(clearTimeout(h),"AbortError"===t.name)throw new e(`Request timeout after ${o}ms`,0,null);if(t instanceof e)throw t;throw new e(`Network error: ${t.message}`,0,null)}}async _handleResponse(t){if(204===t.status)return null;let s;if(s=(t.headers.get("content-type")||"").includes("application/json")?await t.json():await t.text(),!t.ok){let n=t.statusText;throw"object"==typeof s&&s.error?n=s.error:"string"==typeof s&&s&&(n=s),new e(n,t.status,s)}return s}async get(t,e={}){return this.request({method:"GET",path:t,...e})}async post(t,e,s={}){return this.request({method:"POST",path:t,body:e,...s})}async put(t,e,s={}){return this.request({method:"PUT",path:t,body:e,...s})}async delete(t,e={}){return this.request({method:"DELETE",path:t,...e})}async health(){return this.get("/health")}async snapshot(){return this.get("/snapshot")}}class n{constructor(t){this.client=t}async list(){return this.client.get("/nodes")}async create(t){return this.client.post("/nodes",t)}async update(t,e){return this.client.put(`/nodes/${t}`,e)}async delete(t){return this.client.delete(`/nodes/${t}`)}async resetTraffic(t){return this.client.post(`/nodes/${t}/reset-traffic`)}async incrementTraffic(t,e){return this.client.post(`/nodes/${t}/traffic`,e)}async ping(t){return this.client.post(`/nodes/${t}/ping`)}async speedtest(t){return this.client.post(`/nodes/${t}/speedtest`)}async select(t){return this.client.post(`/nodes/${t}/select`)}async bulkPing(t=[]){return this.client.post("/nodes/bulk/ping",{ids:t})}async resetSpeed(t=[]){return this.client.post("/nodes/reset-speed",{ids:t})}}class r{constructor(t){this.client=t}async list(){return this.client.get("/configs")}async import(t){return this.client.post("/configs/import",t)}async update(t,e){return this.client.put(`/configs/${t}`,e)}async delete(t){return this.client.delete(`/configs/${t}`)}async refresh(t){return this.client.post(`/configs/${t}/refresh`)}async pullNodes(t){return this.client.post(`/configs/${t}/pull-nodes`)}async incrementTraffic(t,e){return this.client.post(`/configs/${t}/traffic`,e)}}class i{constructor(t){this.client=t}async list(){return this.client.get("/geo")}async create(t){return this.client.post("/geo",t)}async update(t,e){return this.client.put(`/geo/${t}`,e)}async delete(t){return this.client.delete(`/geo/${t}`)}async refresh(t){return this.client.post(`/geo/${t}/refresh`)}}class o{constructor(t){this.client=t}async list(){return this.client.get("/components")}async create(t){return this.client.post("/components",t)}async update(t,e){return this.client.put(`/components/${t}`,e)}async delete(t){return this.client.delete(`/components/${t}`)}async install(t){return this.client.post(`/components/${t}/install`)}}class c{constructor(t){this.client=t}async status(){return this.client.get("/xray/status")}async start(t={}){return this.client.post("/xray/start",t)}async stop(){return this.client.post("/xray/stop")}}class a{constructor(t){this.client=t,this.rules=new l(t)}async getProfile(){return this.client.get("/traffic/profile")}async updateProfile(t){return this.client.put("/traffic/profile",t)}}class l{constructor(t){this.client=t}async list(){return this.client.get("/traffic/rules")}async create(t){return this.client.post("/traffic/rules",t)}async update(t,e){return this.client.put(`/traffic/rules/${t}`,e)}async delete(t){return this.client.delete(`/traffic/rules/${t}`)}}class u{constructor(t){this.client=t}async getSystemProxy(){return this.client.get("/settings/system-proxy")}async updateSystemProxy(t){return this.client.put("/settings/system-proxy",t)}}function h(t){if(!t)return"-";const e=new Date(t);return Number.isNaN(e.getTime())?String(t):e.toLocaleString()}function p(t){const e=Number(t);if(!e||e<=0)return"0 B";const s=["B","KB","MB","GB","TB"],n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),s.length-1);return`${(e/Math.pow(1024,n)).toFixed(0===n?0:1)} ${s[n]}`}function d(t){if(!t)return"未设置";if("number"==typeof t){if(0===t)return"未设置";return`${Math.round(t/6e10)} 分钟`}return"string"==typeof t?"0s"===t||"0"===t?"未设置":t.replace("m0s","m").replace("h0m0s","h"):String(t)}function f(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function y(t){return!t||t<=0?"-":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function m(t){return!t||t<=0?"-":t>=10?`${t.toFixed(1)} MB/s`:`${t.toFixed(2)} MB/s`}function g(t){return new Promise(e=>setTimeout(e,t))}function w(t){return t?t.split(/[\s,;\n]+/).map(t=>t.trim()).filter(Boolean):[]}function $(t){const e=Number(t);return Number.isFinite(e)?e:0}function b(t,e){let s=null;return function(...n){s&&clearTimeout(s),s=setTimeout(()=>t.apply(this,n),e)}}function T(t,e){let s=0;return function(...n){const r=Date.now();r-s>=e&&(s=r,t.apply(this,n))}}function N(t,e){let s=null,n=!1;return{start(){n||(n=!0,Promise.resolve(t()).catch(console.error),s=setInterval(()=>{Promise.resolve(t()).catch(console.error)},e))},stop(){n&&(n=!1,s&&(clearInterval(s),s=null))},isRunning:()=>n}}async function x(t,e={}){const{maxRetries:s=3,delay:n=1e3,shouldRetry:r=()=>!0}=e;let i;for(let e=0;e<=s;e++)try{return await t()}catch(t){if(i=t,!(e<s&&r(t)))break;await g(n*Math.pow(2,e))}throw i}const P={formatTime:h,formatBytes:p,formatInterval:d,formatLatency:y,formatSpeed:m,escapeHtml:f,sleep:g,parseList:w,parseNumber:$,debounce:b,throttle:T,createPoller:N,retry:x};t.VeaClient=s,t.VeaError=e,t.createAPI=function(t=""){const e=new s({baseURL:t});return{request:async(t,s={})=>e.request({path:t,...s}),get:async(t,s={})=>e.get(t,s),post:async(t,s,n={})=>e.post(t,s,n),put:async(t,s,n={})=>e.put(t,s,n),delete:async(t,s={})=>e.delete(t,s),client:e}},t.createNodeManager=function(t,e=1e3){let s=[],n="",r="",i=null,o=[];async function c(){try{const e=await t.nodes.list();return s=e.nodes||[],n=e.activeNodeId||"",r=e.lastSelectedNodeId||"",o.forEach(t=>{try{t({nodes:s,activeNodeId:n,lastSelectedNodeId:r})}catch(t){console.error("Node listener error:",t)}}),e}catch(t){throw console.error("Failed to fetch nodes:",t),t}}return{getNodes:()=>s,getActiveNodeId:()=>n,getLastSelectedNodeId:()=>r,refresh:async()=>c(),startPolling(){i||(c(),i=setInterval(c,e))},stopPolling(){i&&(clearInterval(i),i=null)},onUpdate:t=>(o.push(t),()=>{o=o.filter(e=>e!==t)})}},t.createPoller=N,t.debounce=b,t.default=s,t.escapeHtml=f,t.formatBytes=p,t.formatInterval=d,t.formatLatency=y,t.formatSpeed=m,t.formatTime=h,t.parseList=w,t.parseNumber=$,t.retry=x,t.sleep=g,t.throttle=T,t.utils=P,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vea-sdk.umd.min.js.map
