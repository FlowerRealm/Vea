<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light">
  <title>Vea Console</title>
  <link rel="stylesheet" href="./css/main.css">
</head>

<body>
  <!-- Titlebar -->
  <div class="titlebar">
    <div class="titlebar-title">
      <div class="logo-dot"></div>
      Vea
    </div>
    <div class="titlebar-controls">
      <div class="window-ctrl" id="minimize-btn"></div>
      <div class="window-ctrl" id="maximize-btn"></div>
      <div class="window-ctrl close" id="close-btn"></div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" id="menu">
    <div class="sidebar-section-title">主要</div>
    <button class="nav-item active" data-target="panel-home">
      <svg viewBox="0 0 24 24">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      控制台
    </button>
    <button class="nav-item" data-target="panel1">
      <svg viewBox="0 0 24 24">
        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
      </svg>
	      FRouter
	    </button>
	    <button class="nav-item" data-target="panel2">
	      <svg viewBox="0 0 24 24">
	        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
	        <polyline points="14 2 14 8 20 8"></polyline>
	        <line x1="16" y1="13" x2="8" y2="13"></line>
	        <line x1="16" y1="17" x2="8" y2="17"></line>
	        <polyline points="10 9 9 9 8 9"></polyline>
	      </svg>
	      订阅
	    </button>
	    <button class="nav-item" data-target="panel-nodes">
	      <svg viewBox="0 0 24 24">
	        <circle cx="12" cy="12" r="3"></circle>
	        <path d="M12 5v4"></path>
	        <path d="M12 15v4"></path>
	        <path d="M5 12h4"></path>
	        <path d="M15 12h4"></path>
	      </svg>
	      节点
	    </button>

	    <div class="sidebar-section-title" style="margin-top: 24px;">系统</div>
	    <button class="nav-item" data-target="panel3">
      <svg viewBox="0 0 24 24">
        <path
          d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
        </path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
	      组件
	    </button>

	    <button class="nav-item" data-target="panel-logs">
	      <svg viewBox="0 0 24 24">
	        <polyline points="4 17 10 11 4 5"></polyline>
	        <line x1="12" y1="19" x2="20" y2="19"></line>
	      </svg>
	      日志
	    </button>

	    <button class="nav-item" data-target="panel-settings">
	      <svg viewBox="0 0 24 24">
	        <circle cx="12" cy="12" r="3"></circle>
        <path
          d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
        </path>
      </svg>
      设置
    </button>
  </aside>

  <!-- Main Content -->
  <main>
    <div id="status" class="status-bar"></div>

    <!-- Dashboard -->
    <section id="panel-home" class="panel active">
      <div class="dashboard-hero">
        <div class="status-ring-container">
          <div class="status-ring-bg"></div>
          <button id="proxy-toggle" data-mode="">
            <svg viewBox="0 0 24 24" width="32" height="32" stroke="currentColor" stroke-width="2.5" fill="none"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
              <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
          </button>
        </div>
        <div class="dashboard-actions">
          <span id="core-state">核心：未知</span>
          <button id="core-restart" class="mini-btn" title="手动重启内核">重启内核</button>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
            </svg>
            延迟
          </div>
          <div class="metric-value" id="home-node-latency">--</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none">
              <polyline points="17 1 21 5 17 9"></polyline>
              <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
              <polyline points="7 23 3 19 7 15"></polyline>
              <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
            </svg>
            速度
          </div>
          <div class="metric-value" id="home-node-speed">--</div>
        </div>
	        <div class="metric-card" id="tun-status-card">
	          <div class="metric-label">
	            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none">
	              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
	              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
	            </svg>
	            TUN 模式
	          </div>
	          <div style="display:flex; align-items:center; gap:12px;">
	            <div class="metric-value" id="tun-status-value" style="cursor:pointer;" title="点击查看详情">--</div>
	            <label class="toggle-switch" title="启用/禁用 TUN 模式">
	              <input type="checkbox" id="tun-toggle">
	              <span class="toggle-slider"></span>
	            </label>
	          </div>
	        </div>
	        <div class="metric-card" id="engine-select-card">
	          <div class="metric-label">
	            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none">
	              <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
	              <rect x="9" y="9" width="6" height="6"></rect>
	            </svg>
	            内核偏好
	          </div>
	          <select id="engine-select" title="选择内核偏好（需要时会重启内核）">
	            <option value="auto" data-label="自动">自动</option>
	            <option value="singbox" data-label="sing-box">sing-box</option>
	            <option value="clash" data-label="Clash">Clash</option>
	          </select>
	        </div>
	        <div class="metric-card" id="ip-geo-card" style="grid-column: span 2;">
	          <div class="metric-label">
	            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none">
	              <circle cx="12" cy="12" r="10"></circle>
	              <line x1="2" y1="12" x2="22" y2="12"></line>
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
              </path>
            </svg>
            当前 IP
          </div>
          <div style="display:flex; align-items:center; gap:16px; flex-wrap:wrap;">
            <div class="metric-value" id="ip-geo-ip" style="font-family:var(--font-mono); font-size:15px;">--</div>
            <div id="ip-geo-location" style="font-size:12px; color:var(--text-secondary);">--</div>
            <button id="ip-geo-refresh"
              style="padding:4px 8px; font-size:11px; background:var(--bg-secondary); border:1px solid var(--border-subtle); border-radius:4px; color:var(--text-secondary); cursor:pointer;">
              <svg viewBox="0 0 24 24" width="12" height="12" stroke="currentColor" stroke-width="2" fill="none"
                style="vertical-align:middle;">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Chain Editor (Route Rules List) -->
    <section id="panel-chain" class="panel">
      <div class="chain-list-container">
        <!-- 头部 -->
        <div class="chain-list-header">
          <div class="chain-list-title">
            <h3>路由规则</h3>
            <p>拖拽调整优先级，位置越靠前优先级越高</p>
          </div>
	          <div class="chain-list-actions">
	            <div class="route-selector">
	              <span>当前 FRouter</span>
	              <select id="chain-route-select"></select>
	            </div>
	            <button id="chain-manage-slots" class="chain-btn">槽位管理</button>
	            <button id="chain-add-rule" class="chain-btn primary">+ 添加规则</button>
	          </div>
	        </div>

        <!-- 可排序规则列表 -->
        <div id="chain-rules-list" class="chain-rules-list">
          <div class="chain-rules-empty">暂无路由规则，点击"添加规则"创建</div>
        </div>

        <!-- 工具栏 -->
        <div class="chain-list-toolbar">
          <span class="toolbar-status" id="chain-status">已保存</span>
          <div class="toolbar-actions">
            <button class="chain-btn" id="chain-back">返回</button>
            <button class="chain-btn" id="chain-reset">重置</button>
            <button class="chain-btn primary" id="chain-save">保存</button>
          </div>
        </div>
      </div>

      <!-- 规则编辑弹窗 -->
      <div class="chain-rule-dialog" id="rule-edit-dialog">
        <div class="chain-rule-dialog-content">
          <div class="chain-rule-dialog-header">
            <h4 id="rule-dialog-title">编辑规则</h4>
            <button class="chain-rule-dialog-close" id="rule-dialog-close">&times;</button>
          </div>

          <div class="chain-rule-dialog-body">
            <div class="chain-form-group">
              <label>规则类型</label>
              <select id="rule-type">
                <option value="">无条件（默认路径）</option>
                <option value="route">路由规则</option>
              </select>
            </div>

            <!-- 路由规则区域 -->
            <div id="rule-route-section" class="chain-route-section" style="display:none;">
              <div class="chain-section-title">路由规则</div>

              <!-- 模板选择器 -->
              <div class="chain-form-group">
                <label>快速应用模板</label>
                <div class="rule-template-picker">
                  <select id="rule-template-category">
                    <option value="all">全部分类</option>
                  </select>
                  <select id="rule-template-select">
                    <option value="">选择模板...</option>
                  </select>
                </div>
              </div>

              <div class="chain-form-group">
                <label>匹配域名</label>
                <textarea id="rule-domains" rows="5" placeholder="每行一个，支持 geosite:cn、domain:example.com 等格式"></textarea>
              </div>
              <div class="chain-form-group">
                <label>匹配 IP</label>
                <textarea id="rule-ips" rows="5" placeholder="每行一个，支持 geoip:cn、192.168.0.0/16 等格式"></textarea>
              </div>
            </div>

            <div class="chain-form-group">
              <label>匹配后去向</label>
              <select id="rule-to">
                <option value="direct">不代理（直连）</option>
                <option value="block">阻断</option>
              </select>
            </div>

            <div class="chain-form-group" id="rule-chain-group" style="display:none;">
              <label>链式代理（后续节点）</label>
              <div id="rule-chain-list" class="rule-chain-list"></div>
              <button class="chain-btn" id="rule-chain-add" type="button">+ 添加节点</button>
              <div class="rule-chain-hint">第一跳在“匹配后去向”里选择，这里从第 2 跳开始添加。</div>
            </div>

            <div class="chain-form-group">
              <label>启用</label>
              <label class="chain-toggle">
                <input type="checkbox" id="rule-enabled" checked>
                <span class="chain-toggle-slider"></span>
              </label>
            </div>

            <div class="chain-form-group">
              <label>描述</label>
              <input type="text" id="rule-description" placeholder="可选：规则描述">
            </div>
          </div>

	          <div class="chain-rule-dialog-footer">
	            <button class="chain-btn danger" id="rule-delete" style="display:none;">删除</button>
	            <div style="flex:1;"></div>
	            <button class="chain-btn" id="rule-cancel">取消</button>
	            <button class="chain-btn primary" id="rule-save">保存</button>
	          </div>
	        </div>
	      </div>

	      <!-- 槽位管理弹窗 -->
	      <div class="chain-rule-dialog" id="slot-manage-dialog">
	        <div class="chain-rule-dialog-content">
	          <div class="chain-rule-dialog-header">
	            <h4>槽位管理</h4>
	            <button class="chain-rule-dialog-close" id="slot-dialog-close">&times;</button>
	          </div>

	          <div class="chain-rule-dialog-body">
	            <div class="chain-form-group">
	              <div id="slot-list" class="slot-list"></div>
	              <div class="rule-chain-hint">槽位是可被规则引用的占位符，可绑定到具体节点；未绑定的槽位会在编译时被跳过。</div>
	            </div>
	          </div>

	          <div class="chain-rule-dialog-footer">
	            <button class="chain-btn" id="slot-add">+ 添加槽位</button>
	            <div style="flex:1;"></div>
	            <button class="chain-btn" id="slot-cancel">关闭</button>
	            <button class="chain-btn primary" id="slot-save">保存</button>
	          </div>
	        </div>
	      </div>
	    </section>

	    <!-- FRouters -->
    <section id="panel1" class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <h2>FRouter</h2>
          <p>管理和监控你的 FRouter 配置。</p>
        </div>
        <div class="panel-actions">
          <button id="node-refresh">刷新 FRouter</button>
        </div>
      </div>

      <div class="node-toolbar">
        <div id="node-tabs" class="node-tabs"></div>
        <button id="node-bulk-ping">全部测延迟</button>
        <button id="node-bulk-speed">全部测速</button>
        <button class="add-node-button" id="node-add-button">+</button>
      </div>
	      <div id="node-grid" class="node-grid">
	        <div class="card" style="text-align:center; color:var(--text-secondary);">暂无 FRouter</div>
	      </div>
	    </section>

    <!-- Configs -->
	    <section id="panel2" class="panel">
	      <div class="panel-header">
	        <div class="panel-title">
	          <h2>订阅</h2>
	          <p>管理订阅源和更新间隔。</p>
	        </div>
	        <div class="panel-actions">
	          <button id="config-add-button" class="primary">添加订阅源</button>
	          <button id="config-refresh">同步</button>
	        </div>
	      </div>
	      <div class="card" style="padding:0;">
	        <table id="config-table">
	          <thead>
	            <tr>
	              <th>名称</th>
	              <th>格式</th>
	              <th>更新间隔</th>
	              <th>最后同步</th>
	              <th>状态</th>
	              <th style="text-align:right">操作</th>
	            </tr>
	          </thead>
	          <tbody></tbody>
	        </table>
	      </div>
	    </section>

	    <!-- Nodes -->
	    <section id="panel-nodes" class="panel">
	      <div class="panel-header">
	        <div class="panel-title">
	          <h2>节点</h2>
	          <p>查看与测量全局节点（独立于 FRouter）。</p>
	        </div>
        <div class="panel-actions">
          <button id="nodes-bulk-ping">全部测延迟</button>
          <button id="nodes-bulk-speed">全部测速</button>
          <button id="nodes-add-button" class="primary">添加节点</button>
        </div>
      </div>
	      <div class="card nodes-table-card">
	        <table id="nodes-table">
	          <thead>
	            <tr>
	              <th>名称</th>
	              <th>协议</th>
	              <th>地址</th>
	              <th>延迟</th>
	              <th>速度</th>
	              <th style="text-align:right">操作</th>
	            </tr>
	          </thead>
	          <tbody>
	            <tr>
	              <td colspan="6" style="text-align:center; color:var(--text-secondary); padding:24px;">暂无节点</td>
	            </tr>
	          </tbody>
	        </table>
	      </div>
	    </section>

	    <!-- Components -->
	    <section id="panel3" class="panel">
	      <div class="panel-header">
	        <div class="panel-title">
	          <h2>组件</h2>
          <p>核心系统依赖和版本。</p>
        </div>
        <div class="panel-actions">
          <button id="component-refresh">刷新</button>
        </div>
      </div>
      <div class="card" style="padding:0;">
        <table id="component-table">
          <thead>
            <tr>
              <th>名称</th>
              <th>类型</th>
              <th>版本</th>
              <th>路径</th>
              <th>日期</th>
              <th>状态</th>
              <th style="text-align:right">操作</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Logs -->
    <section id="panel-logs" class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <h2>日志</h2>
          <p>内核（sing-box / Clash）与应用（后端）运行日志（独立于终端输出）。</p>
        </div>
      </div>

      <div class="node-tabs log-tabs" id="log-tabs">
        <div class="node-tab active" data-log-tab="kernel">系统日志</div>
        <div class="node-tab" data-log-tab="app">应用日志</div>
      </div>

      <div class="card log-card" id="kernel-log-card">
        <div class="log-toolbar">
          <div class="log-meta" id="kernel-log-meta">-</div>
          <div class="log-actions">
            <button class="mini-btn" id="kernel-log-refresh">刷新</button>
            <button class="mini-btn" id="kernel-log-copy">复制</button>
            <div class="log-autoscroll">
              <span class="log-label">自动滚动</span>
              <label class="chain-toggle">
                <input type="checkbox" id="kernel-log-autoscroll" checked>
                <span class="chain-toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
        <div class="log-container" id="kernel-log-container">
          <pre id="kernel-log-content"></pre>
        </div>
      </div>

      <div class="card log-card" id="app-log-card" style="display:none;">
        <div class="log-toolbar">
          <div class="log-meta" id="app-log-meta">-</div>
          <div class="log-actions">
            <button class="mini-btn" id="app-log-refresh">刷新</button>
            <button class="mini-btn" id="app-log-copy">复制</button>
            <div class="log-autoscroll">
              <span class="log-label">自动滚动</span>
              <label class="chain-toggle">
                <input type="checkbox" id="app-log-autoscroll" checked>
                <span class="chain-toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
        <div class="log-container" id="app-log-container">
          <pre id="app-log-content"></pre>
        </div>
      </div>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <h2>设置</h2>
          <p>应用偏好与配置。</p>
        </div>
        <div class="panel-actions">
          <button id="settings-import-btn">导入设置</button>
          <button id="settings-export-btn">导出设置</button>
          <button id="settings-reset-btn">恢复默认</button>
        </div>
      </div>

      <div style="display:flex; gap:24px;">
        <!-- 左侧导航 -->
        <div class="settings-nav" style="flex:0 0 200px; display:flex; flex-direction:column; gap:4px;">
          <button class="settings-nav-item active" data-settings-tab="general">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.4 6.4l-4.2-4.2m-6 0L3.6 7.6m12.8 12.8l-4.2-4.2m-6 0l-4.6 4.6">
              </path>
            </svg>
            外观
          </button>
          <button class="settings-nav-item" data-settings-tab="proxy">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="2" y1="12" x2="22" y2="12"></line>
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
              </path>
            </svg>
            系统代理
          </button>
          <button class="settings-nav-item" data-settings-tab="network">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            TUN
          </button>
          <button class="settings-nav-item" data-settings-tab="singbox">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
              </path>
            </svg>
            sing-box
          </button>
          <button class="settings-nav-item" data-settings-tab="advanced">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
              </path>
            </svg>
            高级
          </button>
        </div>

        <!-- 右侧内容区 -->
        <div style="flex:1; min-width:0;">
          <!-- 外观设置 -->
          <div class="settings-content active" id="settings-general"></div>

          <!-- 系统代理设置 -->
          <div class="settings-content" id="settings-proxy" style="display:none;"></div>

          <!-- TUN 设置 -->
          <div class="settings-content" id="settings-network" style="display:none;"></div>


          <!-- sing-box 设置 -->
          <div class="settings-content" id="settings-singbox" style="display:none;"></div>

          <!-- 高级设置 -->
          <div class="settings-content" id="settings-advanced" style="display:none;"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modals -->

  <div id="node-modal" class="modal">
    <div class="modal-backdrop"></div>
    <div class="modal-content"
      style="max-width: 900px; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transform-origin: center;">
      <button id="node-modal-close" class="modal-close"
        style="position:absolute; top:24px; right:24px; background:none; border:none; color:var(--text-secondary); font-size:20px; cursor:pointer;">×</button>
	      <form id="node-form" class="form-grid">
	        <h3 style="grid-column:1/-1; margin-bottom:16px; font-size:18px; font-weight:600; color:var(--text-primary);">
	          添加 FRouter</h3>

	        <div
	          style="grid-column:1/-1; padding:12px 14px; background:var(--bg-secondary); border-radius:8px; font-size:12px; color:var(--text-secondary); line-height:1.6;">
	          这里只创建一个空的 FRouter（含 1 个配置槽）。节点/订阅请在「订阅」面板里拉取或更新。
	        </div>

	        <!-- Basic Settings -->
	        <div
	          style="display:none; grid-column:1/-1; font-weight:600; font-size:14px; color:var(--text-primary); margin-top:12px; padding-bottom:8px; border-bottom:1px solid var(--border-color);">
	          入口配置</div>
	        <label style="grid-column:1/-1;"><span>FRouter 名称 *</span><input name="name" type="text"
	            placeholder="例如: 香港线路01" required></label>
	        <div style="display:none">
	        <label><span>入口地址 *</span><input name="address" type="text" placeholder="example.com 或 IP"></label>
	        <label><span>入口端口 *</span><input name="port" type="number" placeholder="443"></label>
	        <label>
	          <span>协议 *</span>
          <select name="protocol" id="protocol-select">
            <option value="">选择协议</option>
            <option value="shadowsocks">Shadowsocks</option>
            <option value="vmess">VMess</option>
            <option value="vless">VLESS</option>
            <option value="trojan">Trojan</option>
            <option value="http">HTTP</option>
            <option value="socks5">SOCKS5</option>
	            </select>
          </label>

	        <!-- Shadowsocks Specific -->
	        <div id="ss-fields"
	          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <label>
            <span>加密方式</span>
            <select name="ss_method">
              <option value="aes-256-gcm">aes-256-gcm</option>
              <option value="aes-128-gcm">aes-128-gcm</option>
              <option value="chacha20-ietf-poly1305">chacha20-ietf-poly1305</option>
              <option value="2022-blake3-aes-256-gcm">2022-blake3-aes-256-gcm</option>
              <option value="2022-blake3-aes-128-gcm">2022-blake3-aes-128-gcm</option>
            </select>
          </label>
          <label><span>密码</span><input name="ss_password" type="text" placeholder="密码"></label>
        </div>

        <!-- VMess/VLESS Specific -->
        <div id="vmess-fields"
          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <label><span>UUID</span><input name="vmess_uuid" type="text"
              placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"></label>
          <label>
            <span>AlterID (VMess)</span>
            <input name="vmess_alterid" type="number" value="0" placeholder="0">
          </label>
          <label>
            <span>加密方式</span>
            <select name="vmess_security">
              <option value="auto">auto</option>
              <option value="aes-128-gcm">aes-128-gcm</option>
              <option value="chacha20-poly1305">chacha20-poly1305</option>
              <option value="none">none</option>
            </select>
          </label>
          <label>
            <span>流控 (VLESS)</span>
            <select name="vless_flow">
              <option value="">无</option>
              <option value="xtls-rprx-vision">xtls-rprx-vision</option>
              <option value="xtls-rprx-vision-udp443">xtls-rprx-vision-udp443</option>
            </select>
          </label>
        </div>

        <!-- Trojan Specific -->
        <div id="trojan-fields" style="display:none; grid-column:1/-1;">
          <label><span>密码</span><input name="trojan_password" type="text" placeholder="密码"></label>
        </div>

        <!-- HTTP/SOCKS5 Specific -->
        <div id="proxy-fields"
          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <label><span>用户名</span><input name="proxy_username" type="text" placeholder="可选"></label>
          <label><span>密码</span><input name="proxy_password" type="text" placeholder="可选"></label>
        </div>

        <!-- Network Settings -->
        <div
          style="grid-column:1/-1; font-weight:600; font-size:14px; color:var(--text-primary); margin-top:16px; padding-bottom:8px; border-bottom:1px solid var(--border-color);">
          传输设置</div>
        <label>
          <span>传输协议</span>
          <select name="network" id="network-select">
            <option value="tcp">TCP</option>
            <option value="ws">WebSocket</option>
            <option value="h2">HTTP/2</option>
            <option value="grpc">gRPC</option>
            <option value="quic">QUIC</option>
          </select>
        </label>
        <label>
          <span>TLS</span>
          <select name="tls">
            <option value="">不启用</option>
            <option value="tls">TLS</option>
            <option value="xtls">XTLS</option>
          </select>
        </label>

        <!-- WebSocket Settings -->
        <div id="ws-fields"
          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <label style="grid-column:1/-1"><span>WebSocket 路径</span><input name="ws_path" type="text"
              placeholder="/path"></label>
          <label style="grid-column:1/-1"><span>Host</span><input name="ws_host" type="text"
              placeholder="example.com"></label>
        </div>

        <!-- HTTP/2 Settings -->
        <div id="h2-fields"
          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <label style="grid-column:1/-1"><span>HTTP/2 路径</span><input name="h2_path" type="text"
              placeholder="/path"></label>
          <label style="grid-column:1/-1"><span>Host</span><input name="h2_host" type="text"
              placeholder="example.com"></label>
        </div>

        <!-- gRPC Settings -->
        <div id="grpc-fields" style="display:none; grid-column:1/-1;">
          <label><span>gRPC ServiceName</span><input name="grpc_service" type="text" placeholder="ServiceName"></label>
        </div>

        <!-- TLS Settings -->
	        <div id="tls-fields"
	          style="display:none; grid-column:1/-1; display:grid; grid-template-columns:1fr 1fr; gap:16px;">
	          <label style="grid-column:1/-1"><span>SNI</span><input name="tls_sni" type="text"
	              placeholder="留空使用服务器地址"></label>
          <label style="grid-column:1/-1"><span>指纹 (Fingerprint)</span>
            <select name="tls_fingerprint">
              <option value="">不设置</option>
              <option value="chrome">Chrome</option>
              <option value="firefox">Firefox</option>
              <option value="safari">Safari</option>
              <option value="edge">Edge</option>
              <option value="random">随机</option>
            </select>
	          </label>
	        </div>
	        </div>

	        <!-- Other Settings -->
	        <div
	          style="display:none; grid-column:1/-1; font-weight:600; font-size:14px; color:var(--text-primary); margin-top:16px; padding-bottom:8px; border-bottom:1px solid var(--border-color);">
	          其他设置</div>
	        <label style="grid-column:1/-1"><span>FRouter 标签</span><input name="tags" type="text"
	            placeholder="多个标签用逗号分隔, 例如: 香港,IPLC,游戏"></label>

	        <div class="form-actions">
	          <button type="button" id="node-modal-reset">重置</button>
	          <button type="submit" class="primary">创建 FRouter</button>
	        </div>
      </form>
    </div>
  </div>

  <div id="nodes-modal" class="modal">
    <div class="modal-backdrop"></div>
    <div class="modal-content" style="max-width: 760px; max-height: 90vh; overflow-y: auto;">
      <button id="nodes-modal-close" class="modal-close"
        style="position:absolute; top:24px; right:24px; background:none; border:none; color:var(--text-secondary); font-size:20px; cursor:pointer;">×</button>
      <form id="nodes-form" class="form-grid" novalidate>
        <h3 id="nodes-modal-title" style="grid-column:1/-1; margin-bottom:16px; font-size:18px; font-weight:600; color:var(--text-primary);">
          添加节点</h3>

        <label id="nodes-sharelink-row" style="grid-column:1/-1;">
          <span>分享链接 (可选)</span>
          <textarea name="shareLink" style="height:72px;" placeholder="vless:// / vmess:// / trojan:// / ss:// (支持 base64 订阅内容)"></textarea>
        </label>

        <label><span>节点名称 *</span><input name="name" type="text" required placeholder="例如: 香港01"></label>
        <label><span>服务器地址 *</span><input name="address" type="text" required placeholder="example.com 或 IP"></label>
        <label><span>端口 *</span><input name="port" type="number" min="1" max="65535" required placeholder="443"></label>
        <label>
          <span>协议 *</span>
          <select name="protocol" id="nodes-protocol-select" required>
            <option value="shadowsocks">Shadowsocks</option>
            <option value="vmess">VMess</option>
            <option value="vless">VLESS</option>
            <option value="trojan">Trojan</option>
          </select>
        </label>
        <label style="grid-column:1/-1;"><span>标签</span><input name="tags" type="text"
            placeholder="多个标签用逗号分隔, 例如: 香港,游戏"></label>

        <div
          style="grid-column:1/-1; font-weight:600; font-size:14px; color:var(--text-primary); margin-top:8px; padding-bottom:8px; border-bottom:1px solid var(--border-color);">
          认证信息</div>

        <div id="nodes-ss-fields"
          style="grid-column:1/-1; display:none; grid-template-columns:1fr 1fr; gap:16px;">
          <label>
            <span>加密方式</span>
            <select name="ss_method">
              <option value="aes-256-gcm">aes-256-gcm</option>
              <option value="aes-128-gcm">aes-128-gcm</option>
              <option value="chacha20-ietf-poly1305">chacha20-ietf-poly1305</option>
              <option value="2022-blake3-aes-256-gcm">2022-blake3-aes-256-gcm</option>
              <option value="2022-blake3-aes-128-gcm">2022-blake3-aes-128-gcm</option>
            </select>
          </label>
          <label><span>密码</span><input name="ss_password" type="text" placeholder="密码"></label>
        </div>

        <div id="nodes-vmess-fields"
          style="grid-column:1/-1; display:none; grid-template-columns:1fr 1fr; gap:16px;">
          <label><span>UUID</span><input name="vmess_uuid" type="text"
              placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"></label>
          <label>
            <span>AlterID (VMess)</span>
            <input name="vmess_alterid" type="number" value="0" placeholder="0">
          </label>
          <label>
            <span>加密方式</span>
            <select name="vmess_security">
              <option value="auto">auto</option>
              <option value="aes-128-gcm">aes-128-gcm</option>
              <option value="chacha20-poly1305">chacha20-poly1305</option>
              <option value="none">none</option>
            </select>
          </label>
          <label>
            <span>流控 (VLESS)</span>
            <select name="vless_flow">
              <option value="">无</option>
              <option value="xtls-rprx-vision">xtls-rprx-vision</option>
              <option value="xtls-rprx-vision-udp443">xtls-rprx-vision-udp443</option>
            </select>
          </label>
        </div>

        <div id="nodes-trojan-fields" style="grid-column:1/-1; display:none;">
          <label><span>密码</span><input name="trojan_password" type="text" placeholder="密码"></label>
        </div>

        <div
          style="grid-column:1/-1; font-weight:600; font-size:14px; color:var(--text-primary); margin-top:8px; padding-bottom:8px; border-bottom:1px solid var(--border-color);">
          传输设置</div>
        <label>
          <span>传输协议</span>
          <select name="network" id="nodes-network-select">
            <option value="tcp">TCP</option>
            <option value="ws">WebSocket</option>
            <option value="http">HTTP</option>
            <option value="h2">HTTP/2</option>
            <option value="grpc">gRPC</option>
          </select>
        </label>
        <label>
          <span>TLS</span>
          <select name="tls" id="nodes-tls-select">
            <option value="">不启用</option>
            <option value="tls">TLS</option>
          </select>
        </label>

        <div id="nodes-ws-fields"
          style="grid-column:1/-1; display:none; grid-template-columns:1fr 1fr; gap:16px;">
          <label style="grid-column:1/-1"><span>WebSocket 路径</span><input name="ws_path" type="text"
              placeholder="/path"></label>
          <label style="grid-column:1/-1"><span>Host</span><input name="ws_host" type="text"
              placeholder="example.com"></label>
        </div>

        <div id="nodes-http-fields"
          style="grid-column:1/-1; display:none; grid-template-columns:1fr 1fr; gap:16px;">
          <label style="grid-column:1/-1"><span>HTTP 路径</span><input name="h2_path" type="text"
              placeholder="/path"></label>
          <label style="grid-column:1/-1"><span>Host</span><input name="h2_host" type="text"
              placeholder="example.com"></label>
        </div>

        <div id="nodes-grpc-fields" style="grid-column:1/-1; display:none;">
          <label><span>gRPC ServiceName</span><input name="grpc_service" type="text" placeholder="ServiceName"></label>
        </div>

        <div id="nodes-tls-fields"
          style="grid-column:1/-1; display:none; grid-template-columns:1fr 1fr; gap:16px;">
          <label style="grid-column:1/-1"><span>SNI</span><input name="tls_sni" type="text"
              placeholder="留空使用服务器地址"></label>
          <label style="grid-column:1/-1"><span>指纹 (Fingerprint)</span>
            <select name="tls_fingerprint">
              <option value="">不设置</option>
              <option value="chrome">Chrome</option>
              <option value="firefox">Firefox</option>
              <option value="safari">Safari</option>
              <option value="edge">Edge</option>
              <option value="random">随机</option>
            </select>
          </label>
          <label style="grid-column:1/-1"><span>证书校验</span>
            <select name="tls_insecure">
              <option value="false">严格校验</option>
              <option value="true">跳过校验</option>
            </select>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" id="nodes-modal-reset">重置</button>
          <button type="submit" class="primary">创建节点</button>
        </div>
      </form>
    </div>
  </div>

  <div id="config-modal" class="modal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <button id="config-modal-close" class="modal-close"
        style="position:absolute; top:24px; right:24px; background:none; border:none; color:var(--text-secondary); font-size:20px; cursor:pointer;">×</button>
      <form id="config-form" class="form-grid">
        <h3 id="config-modal-title" style="grid-column:1/-1; margin-bottom:16px; font-size:18px; font-weight:600; color:var(--text-primary);">
          添加订阅</h3>
        <label><span>名称</span><input name="name" type="text" required placeholder="例如: My Server"></label>
        <label style="grid-column:1/-1"><span>订阅链接</span><input name="sourceUrl" type="url" required
            placeholder="https://..."></label>
        <label><span>更新间隔 (分钟，0=关闭)</span><input name="autoUpdateInterval" type="number" min="0" value="60"></label>
        <label style="grid-column:1/-1"><span>配置内容 (可选)</span><textarea name="payload"
            style="height:80px;"></textarea></label>
        <div class="form-actions">
          <button type="button" id="config-modal-reset">重置</button>
          <button type="submit" class="primary">保存订阅</button>
        </div>
      </form>
    </div>
  </div>

  <script src="./js/settings-schema.js"></script>
  <script src="./_shared/vendor/dagre-0.8.5.min.js"></script>
  <!-- Rule Templates (保留) -->
  <script src="./js/rule-templates.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>

</html>
