# Vea Backend

FastAPI 服务端用于管理 xray/sing-box 节点、配置文件、Geo 数据以及流量策略。服务暴露 Restful API 供前端集成，并包含自动同步、测速、分流策略等能力。

## 功能概览

- 节点管理：增删改查、流量统计、手动更新、延迟与速度测试。
- 配置文件管理：支持 xray/sing-box JSON、V2RayN、Clash 等格式的导入与自动同步；记录流量统计和到期信息。
- Geo 资源维护：自动下载与更新 GeoIP/GeoSite 等文件，并保留校验信息。
- 分流与 DNS 设置：维护自定义流量规则、默认节点、DNS 服务器等，提供可调整的系统设置。
- 自动化任务：后台定时轮询配置、Geo 资源、节点延迟，保证数据与真实环境同步。

## 技术栈

- 后端框架：Python 3.11 + FastAPI
- 数据层：SQLModel + SQLite（默认，可替换）
- 任务调度：基于 `asyncio` 的后台循环任务

## 快速开始

1. 确保本地安装 Python 3.11 及以上版本。

2. 安装依赖：

   ```bash
   pip install -e .
   ```

3. 运行服务：

   ```bash
   uvicorn app.main:app --reload
   ```

4. 打开 `http://127.0.0.1:8000/docs` 查看自动生成的交互式接口文档。

## API 大纲

- `GET /health` 健康检查。
- `/nodes` 节点管理接口（创建、更新、删除、流量上报、延迟/速度测试）。
- `/configs` 配置文件管理（导入、更新、自动刷新、统计数据更新）。
- `/geo` Geo 资源维护（新增、更新、同步、删除）。
- `/traffic` 分流规则与系统设置。

## 持久化

默认使用 `data.db`（SQLite）存储数据，可根据需要在 `app/database.py` 中调整数据库连接字符串。

## 前端对接建议

- 所有更新接口均返回最新实体，可直接用于刷新前端状态。
- 测速接口会在数据库中更新节点最近一次的延迟与速度，避免重复调用。
- 自动同步任务运行在后台，可通过轮询或 WebSocket（后续可扩展）获取实时状态。

## 许可证

本项目遵循 [MIT](LICENSE) 开源协议。
