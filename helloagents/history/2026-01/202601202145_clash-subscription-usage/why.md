# 变更提案: Clash 订阅用量显示（已用/总量）

## 需求背景
目前部分订阅服务会在订阅内容中塞入一个“提示用量/到期”的假节点（常见 `127.0.0.1:1080` + 名称含 `traffic/expire/流量/到期`）。这不是可用的代理节点，解析/展示逻辑不应依赖这种 hack。

Vea 需要按 Clash 生态的通用约定，从订阅 HTTP 响应头 `subscription-userinfo` 获取用量字段，在“订阅”列表中为每条订阅展示“已用/总量”（已用通常等于 upload+download）。

## 变更内容
1. 订阅同步时解析 `subscription-userinfo`，计算并持久化用量数据到 `Config`。
2. 前端订阅列表展示每条订阅的“已用/总量”（无数据时显示 `—`）。
3. 保持现有“过滤提示节点”的行为，不再通过“拉一个用量名称的节点”展示用量。

## 影响范围
- **模块:**
  - `backend`（订阅同步下载、用量解析、数据模型）
  - `frontend`（订阅列表渲染）
  - `frontend/sdk`（类型同步）
- **API:**
  - `GET /configs`：`Config` 增量字段（新增字段，不破坏旧字段）
- **数据:**
  - `state.json`：`Config` 增量字段（新增，可选）

## 核心场景

### 需求: 订阅用量展示
**模块:** backend / frontend

在“订阅”列表中展示“已用/总量”，来源为订阅响应头，不依赖假节点。

#### 场景: 同步成功并展示用量
订阅服务在 HTTP 响应头返回 `subscription-userinfo: upload=...; download=...; total=...`。
- 预期结果: 同步完成后，该订阅行显示“已用/总量”，其中已用=upload+download。

#### 场景: 响应头缺失或字段不完整
订阅服务不返回 `subscription-userinfo` 或缺少 `total` 等字段。
- 预期结果: 不影响同步；订阅行用量显示为 `—`。

#### 场景: 响应头格式异常
字段无法解析（非数字/负数/溢出/混入额外字段）。
- 预期结果: 不让同步失败；该次同步不更新用量；订阅行用量显示 `—` 或保留上次可用值（按实现策略）。

## 风险评估
- **风险:** 订阅服务实现不统一（header 名大小写、分隔符差异、字段缺失）。
  - **缓解:** 解析器宽松兼容（大小写不敏感、按 `;`/`,` 分割、忽略未知字段），失败不影响主流程。
- **风险:** `int64` 用量在极端情况下可能超过 JS 安全整数。
  - **缓解:** 先按常见规模以 JSON number 传递并展示；如遇到真实需求再升级为字符串字段（不在本次范围内）。

