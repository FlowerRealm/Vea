# 技术设计: 修复订阅名首次进入显示乱码（Issue #42）

## 技术方案

### 核心技术
- **前端:** Electron 主题页（原生 DOM + JS）
- **后端接口:** `GET /configs`、`GET /nodes`（已有）

### 实现要点

#### 现状与根因
- 订阅分组标题由 `formatSubscriptionLabel(configId)` 计算：优先从 `configsCache` 通过 `getConfigNameById` 找到配置名，否则回退到 `String(configId)`。
- 节点面板在首次进入时会触发 `loadNodes()`，但**不会自动触发 `loadConfigs()`**；而 `configsCache` 初始为空数组，导致订阅名回退显示为 `configId`（用户感知为“乱码/随机字符串”）。
- 当用户切换到“订阅/配置”面板时才会触发 `loadConfigs()`，配置名加载后再返回节点面板即可显示正常。

#### 修复方案（推荐）
- 将 `configsCache` 初始值由 `[]` 调整为 `null`，用于区分“未加载”与“已加载但为空”。
- 在 `loaders["panel-nodes"]` 中：首次进入节点面板时若 `configsCache` 未加载，则先 `await loadConfigs()`，再 `loadNodes()`，保证订阅名首次进入即可正确显示。

### 备选方案
- **备选:** 在 `loadNodes()` 内部检测 `configsCache` 未加载时先加载配置再渲染（侵入更深，容易影响轮询逻辑，不如面板入口处处理直观）。
- **不推荐:** 仅在 DOM 中局部更新分组标题（实现复杂、同步点易遗漏，维护成本更高）。

## 架构设计
无（仅前端渲染逻辑调整）

## 架构决策 ADR
无

## API 设计
无

## 数据模型
无

## 安全与性能
- **安全:** 不涉及敏感信息处理、权限控制或外部服务变更。
- **性能:** 首次进入节点面板会额外请求一次 `/configs`；通过 `configsCache=null` 的哨兵逻辑避免重复请求，且不改变原有节点指标轮询刷新路径。

## 测试与部署
- **手工复现验证（Windows 10）：**
  1. 更新节点订阅
  2. 退出并重启 Vea
  3. 进入节点界面：订阅名应立即正确显示
  4. 切换 light/dark 主题验证一致
- **回归检查：**
  - 刷新配置列表后，订阅名能同步更新
  - 节点测速/测延迟指标刷新仍正常
