# 技术设计: 修复订阅同步节点 ID 复用（Issue #55）

## 技术方案

### 核心技术
- Go（后端）
- 订阅同步逻辑：`backend/service/config`

### 实现要点
- 现有复用策略分两层：
  1) `fingerprintKey`（严格匹配，包含传输/TLS 细节）
  2) `identityKey`（宽松匹配，忽略部分传输/TLS 细节，用于允许订阅端小幅变更）
- 当前问题点：当 `identityKey` 在历史节点中出现冲突（同 identity 多节点）且同步时传输细节发生变化时，`fingerprintKey` 与 `identityKey` 都无法唯一匹配，导致无法复用历史 `node.ID`。
- 修复策略：构建 `identity + name` 的索引，在 identity 冲突时使用名称做唯一定位；仍坚持“唯一才复用”的原则，避免错误匹配。

## 安全与性能
- **安全:** 不引入外部输入执行；仅做纯内存映射与字符串归一化
- **性能:** 复用索引为 O(n) 构建与 O(n) 应用；对订阅节点规模可接受

## 测试与部署
- **测试:** 增加单元测试覆盖 identity 冲突 + 传输细节变化仍复用 ID 的场景；运行 `go test ./...`
- **部署:** 无额外部署步骤；随后端发布即可生效

